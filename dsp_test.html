<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DSP Test</title>
</head>
<body>
    <script src="scripts/dsp.js"></script>
    <script>
        var signalArray = [3,2,6,9,2,3,6,9,2,10,30,69,3,2,9,62,30,21,54,32,95,62,1,21,32,62,48,52,1,32,3,8];
        var rfft = new RFFT(32,8);
        rfft.forward(signalArray);
        console.log(rfft.trans);
        var index = bandPass(rfft, 0.8,3);
        var max = 0;
        var max_index = 0;
        for(var i = index[0]; i<=index[1]; i++){
            if(rfft.trans[i]>max){
                max = rfft.trans[i];
                max_index = i;
            }
        }
        max_index++; //making it like it started from 1;
        console.log("Maximum Magnitude at Index: "+max_index);
        console.log("Maximum (Real)Magnitude: "+rfft.trans[max_index/2 - 1]);
        console.log("Maybe Maximum (Imaginary) Magnitude: "+rfft.trans[max_index/2 +1])

        //3 to 12 index:
        function bandPass(rfft, low_freq, high_freq){
            var low_index, high_index;
            low_index = 0;
            high_index = 0;
            low_flag = false;
            high_flag = false;
            for (var i = rfft.trans.length - 1; i >= 0; i--) {
                if(!low_flag){
                    if(isNear(rfft.getBandFrequency(i),0.8, rfft.getBandFrequency(0))){
                        low_index = i;
                        low_flag = true;
                    }
                }
                if(!high_flag){
                    if(isNear(rfft.getBandFrequency(i),3, rfft.getBandFrequency(0))){
                        high_index = i;
                        high_flag = true;
                    }
                }
            };
            return [low_index, high_index];
        }

        function isNear(val1, val2, tolerance, biasedTo){
            //console.log("Val1: "+val1+" and Val2: "+val2);
            biasedTo = biasedTo || "none";
            

            if(biasedTo == "low") {
                if(val2>val1) return false;
            } else if(biasedTo == "high") {
                if(val1>val2) return false;
            }

            err = val1 - val2;            
            err = err>=0 ? err : -err;
            //console.log("Error: "+err);
            if(err<=tolerance){
                return true;
            }
            return false;
        }

    </script>
</body>
</html>